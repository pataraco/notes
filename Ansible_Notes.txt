-----------------
- Ansible Notes -
-----------------

Community: galaxy.ansible.com - Ansible Galaxy; hub for finding, reusing, and sharing the best Ansible content.

Installation
------------
- Latest Released - use package managers, otherwise use `pip`
	- Control Machine Requirements
		- Python 2.6/2.7
	  Install
		- AWS - create a RHEL instance	# ansible-control
		- change hostname
		- python 2.7.5 already installed
		- yum update
		- yum install git
		- git clone git://github.com/ansible/ansible.git --recursive
		- yum install wget
		- install EPEL repo (/etc/yum.repos.d/epel.repo)
			- wget https://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm
			- rpm -Uvh epel-release-7-5.noarch.rpm
				OR
			- rpm -ivh https://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm
		  From Source
			- cd ansible
			- source ./hacking/env-setup
			- source ./hacking/env-setup -q	# to suppress spurious warnings/errors
			- yum install python-pip (need EPEL repo)
			(NOT Complete)
		 >From package (needs EPEL)
			- yum install wget
			- yum install ansible
		  Build and install from package
			- cd ansible
			- make rpm
			(NOT Complete)
	- Managed Node Requirements
		- ssh (sftp or config to scp in ansible.cfg)
		- Python 2.4+ (< 2.5 need "python-simplejson")
		- libselinux-python (if SELinux enabled)

Getting Started
	First setup and commands
	- vi /etc/ansible/hosts
	- ansible all -m ping [-u user] [--sudo|-b [--become-user user]] [--private-key]
	- ansible all -a uptime
	- ansible all -a "echo hello world"
	Turn off Host Key Checking
	- vi /etc/ansible/ansible.cfg or ~/.ansible.cfg
	  [defaults]
	  host_key_checking = False
		OR
	- export ANSIBLE_HOST_KEY_CHECKING=False
Iventory
	/etc/ansible/hosts
		- host
		- [group]
		- host:port
		- alias ansible_port=PORT ansible_host=IP
		- www[01:50].example.com
		- db-[a:f].example.com
		- HOST	ansible_connection=local
		  HOST2	ansible_connection=ssh	ansible_user=USER
		- host1 http_port=80	maxRequestsPerChild=800
		  host2 http_port=303	maxRequestsPerChild=900
		- [GROUP]
		  host1
		  host2
		  [GROUP:vars]
		  ntp_server=ntp.example.com
		  proxy=proxy.example.com
Introduction to Ad-Hoc Commands 	http://docs.ansible.com/ansible/intro_adhoc.html
	$ ansble <pattern> -m <module> -a <arguments>
		Patterns:
			all|*|GROUP|G1:G2|G1:!G2|G1:&G2|G1:G2:&G3:!G4|*.example.com|*.com:G
		 Index	GROUP[0]|GROUP[-1]|G[2:3]|G[:2]
		 RegEx	~(web|db).*\.example\.com	# regular exp
		 CLI	ansible --limit @these_hosts.txt
	$ ansible GROUP -a "/sbin/reboot" -f 10		# fork 10
	$ ansible GROUP -a "/sbin/reboot" -u USERNAME
	$ ansible GROUP -a "/sbin/reboot" -u USERNAME --become|-b [--ask-become-pass|-k]
	$ ansible GROUP -a "/sbin/reboot" -u USERNAME --become-user USERNAME [--ask-become-pass|-k]
	$ ansible HOSTS -m shell -a 'echo $TERM'
	$ ansible HOSTS -m copy -a "src=/etc/hosts dest=/tmp/hosts"
	$ ansible HOSTS -m file -a "dest=/etc/hosts mode=660 owner=USER group=GROUP"
	$ ansible HOSTS -m file -a "dest=/etc/ansible mode=775 owner=USER group=GROUP state=directory"
	$ ansible HOSTS -m file -a "dest=/etc/ansible state=absent"
	$ ansible webservers -m yum -a "name=acme state=present"	# pkg installed
	$ ansible webservers -m yum -a "name=acme-1.5 state=present"	# version of pkg installed
	$ ansible webservers -m yum -a "name=acme state=latest"		# lastest of pkg installed
	$ ansible webservers -m yum -a "name=acme state=absent"		# pkg NOT installed
	$ ansible all -m user -a "name=foo password=<crypted password here>"
	$ ansible all -m user -a "name=foo state=absent"
	$ ansible webservers -m git -a "repo=git://foo.example.org/repo.git dest=/srv/myapp version=HEAD"
	$ ansible webservers -m service -a "name=httpd state=started"
	$ ansible webservers -m service -a "name=httpd state=restarted"
	$ ansible webservers -m service -a "name=httpd state=stopped"
	$ ansible all|localhost -m setup
Playbooks
Roles
	roles/ROLE: files, templates, tasks, handlers, vars, defaults, meta (dependencies)
